const baseUri = '/api';

const request = async (method, url, data) => {
	const opts = { method, headers: {} };

	if (data) {
		opts.headers['Content-Type'] = 'application/json';
		opts.body = JSON.stringify(data);
	}

	const res = await fetch(`${baseUri}/${url}`, opts);

	let statusCode = res.status;
	let resInfo = { statusCode, ok: res.ok };

	if (statusCode === 504)
		return {
			data: { errors: { message: 'An error has occurred. Try later' } },
			...resInfo
		};

	const json = await res.text();

	try {
		return { data: JSON.parse(json), ...resInfo };
	} catch (err) {
		return { data: json, ...resInfo };
	}
};

export { request };
