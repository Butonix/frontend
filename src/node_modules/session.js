import expressSession from 'express-session';
import pgSession from 'connect-pg-simple';
import { Pool } from 'pg';

const configPool = new Pool({
  user: 'process.env.USER_SESSIONS_DB_USERNAME',
  database: 'process.env.USER_SESSIONS_DB_NAME',
  password: 'process.env.USER_SESSIONS_DB_PASSWORD'
});

const sessionStore = pgSession(expressSession);

const session = () =>
  expressSession({
    secret: 'process.env.USER_SESSIONS_SECRET',
    resave: false,
    rolling: true,
    saveUninitialized: true,
    cookie: {
      httpOnly: true,
      sameSite: true,
      maxAge: 31104000000, // 1 year
      secure: false
    },
    store: new sessionStore({
      pool: configPool,
      tableName: 'process.env.USER_SESSIONS_NAME'
    })
  });

export { session };
