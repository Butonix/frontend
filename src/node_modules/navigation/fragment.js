import { writable } from 'svelte/store';

let hasLocation = typeof location !== 'undefined';

function createStore() {
  let defaultHash = hasLocation ? location.hash : '';

  let fragment = writable(defaultHash, set => {
    function handler() {
      set(location.hash);
    }

    hasLocation && window.addEventListener('hashchange', handler);

    return () => {
      hasLocation && window.removeEventListener('hashchange', handler);
    };
  });

  function set(value) {
    location.hash = value;

    fragment.set(value);
  }

  return {
    subscribe: fragment.subscribe,
    set
  };
}

export let fragment = createStore();
